<!DOCTYPE html>
<html>
  
{{ header|safe }}

<br>

<div class="container">

  <div id="chart_div" style="width: 400px; height: 120px;" hidden></div>
  <div class="row">
    <div class="col">
      <h1>Welcome, {{ user.first_name }}!</h1>
    </div>
    <div class="col">
      <h2>Points: {{ user.last_name }}</h2>
    </div>
  <br><br>
  
  <div class="row">
        <div class="col-4">
          <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">Article of the Day</h5>
              <p class="card-text">Read today's article and earn up to 20 points after completing the multiple choice test at the end.</p>
              <a id="daily_article" href="/daily_article" class="btn btn-primary">Get Started!</a>
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">Flashcards</h5>
              <p class="card-text">You have XX words in your queue to learn. Earn 1 point per word memorized!</p>
              <a href="#" class="btn btn-primary" disabled>Coming soon!</a>
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">Memorize Poetry</h5>
              <p class="card-text">Earn 30 points by memorizing a poem!</p>
              <a href="/poetry" class="btn btn-primary" disabled>Coming Soon!</a>
            </div>
          </div>
        </div>
  </div>
</div>
    
<script type="text/javascript">
  function pad(num) {
    return num < 10 ? '0' : '' + num;
  }

  function getNewYorkISODateString() {
      // Get the current date in UTC
      const now = new Date();

      // Create a new date in the New York time zone
      const options = { timeZone: 'America/New_York', hour12: false };
      const newYorkDate = new Date(now.toLocaleString('en-US', options));

      // Calculate the time zone offset
      const offset = -newYorkDate.getTimezoneOffset();
      const sign = offset >= 0 ? '+' : '-';
      const hours = pad(Math.floor(Math.abs(offset) / 60));
      const minutes = pad(Math.abs(offset) % 60);

      // Construct the ISO 8601 string
      const isoString = newYorkDate.getFullYear() +
          '-' + pad(newYorkDate.getMonth() + 1) +
          '-' + pad(newYorkDate.getDate()) +
          'T' + pad(newYorkDate.getHours()) +
          ':' + pad(newYorkDate.getMinutes()) +
          ':' + pad(newYorkDate.getSeconds()) +
          sign + hours + ':' + minutes;

      return isoString;
  }
  console.log(getNewYorkISODateString());
  console.log(localStorage.getItem("last_article_date"));
  //If last_article_date is today, disable the daily_article button
  //And make it say "Already Completed"
  if (localStorage.getItem("last_article_date") == getNewYorkISODateString()) {
    document.getElementById("daily_article").disabled = true;
    document.getElementById("daily_article").innerText = "Already Completed";
  }

  google.charts.load('current', {'packages':['gauge']});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {

    var data = google.visualization.arrayToDataTable([
      ['Label', 'Value'],
      ['Memory', 80],
      ['CPU', 55],
      ['Network', 68]
    ]);

    var options = {
      width: 400, height: 120,
      redFrom: 90, redTo: 100,
      yellowFrom:75, yellowTo: 90,
      minorTicks: 5
    };

    var chart = new google.visualization.Gauge(document.getElementById('chart_div'));

    chart.draw(data, options);

    setInterval(function() {
      data.setValue(0, 1, 40 + Math.round(60 * Math.random()));
      chart.draw(data, options);
    }, 13000);
    setInterval(function() {
      data.setValue(1, 1, 40 + Math.round(60 * Math.random()));
      chart.draw(data, options);
    }, 5000);
    setInterval(function() {
      data.setValue(2, 1, 60 + Math.round(20 * Math.random()));
      chart.draw(data, options);
    }, 26000);
  }
</script>

  </body>
</html>


<!DOCTYPE html>
<html>
  
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

{{ header|safe }}

<div class="container">
  
    <div class="row">
        <!--center the text-->
        <div class="col">
            <h1 class="text-center">Step 1: Read the Article</h1>
            <br><br>
        </div>
    </div>
    <div class="row">
        <!--make the background here light grey-->
        <div class="col-8" style="background-color: #f8f9fa;">
            <h2>{{title}}</h2>
            <!-- article contents here-->
            {% for paragraph in paragraphs %}
                <p id="{{paragraph.tag}}"">{{paragraph.text}}</p>
            {% endfor %}
        </div>
        <!--make the background dark grey and all the text off-white-->
        <div class="col-4" style="background-color: #343a40; color: #f8f9fa;">
            <!-- word list here-->
            <h3>Vocabulary</h3>
        </div>
    </div>
    <div class="row">
        <!--center the text-->
        <div class="col">
            <div class="d-grid gap-2">
                <br><br>
                <button class="btn btn-primary" type="button">Review Vocabulary</button>
                <br><br>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Function to wrap words in span elements
  function wrapWordsInSpan(paragraph) {
    const textContent = paragraph.innerText;
    const words = textContent.split(/(\s+)/).filter(word => word.trim().length > 0);
    paragraph.innerHTML = words.map(word => `<span class="word">${word}</span>`).join('');
  }

  // Function to get the complete sentence containing the clicked word
  function getSentenceContainingWord(paragraphText, clickedWord) {
    const sentenceRegex = /[^.!?]*[.!?]/g;
    const sentences = paragraphText.match(sentenceRegex);
    let clickedSentence = '';

    sentences.forEach(sentence => {
      if (sentence.includes(clickedWord)) {
        clickedSentence = sentence.trim();
      }
    });

    return clickedSentence;
  }

  // Initialize a variable to store clicked word and sentence
  let clickedData = [];

  // Get all paragraphs
  const paragraphs = document.querySelectorAll('p[id^="paragraph"]');

  // Process each paragraph
  paragraphs.forEach(paragraph => {
    // Wrap words in span elements
    wrapWordsInSpan(paragraph);

    // Add event listeners to each word
    paragraph.querySelectorAll('.word').forEach(span => {
      span.addEventListener('click', function(event) {
        const clickedWord = event.target.innerText;
        const paragraphText = paragraph.innerText;
        const clickedSentence = getSentenceContainingWord(paragraphText, clickedWord);

        // Store the clicked word and its sentence
        clickedData.push({ word: clickedWord, sentence: clickedSentence });

        console.log(clickedData); // For debugging

        // Here you can prepare the XHR request with clickedData
      });
    });
  });
});
</script>
    

  </body>
</html>


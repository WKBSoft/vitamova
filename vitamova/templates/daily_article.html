<!DOCTYPE html>
<html>
  
{{ header|safe }}

<div class="container">
  
    <div class="row">
        <!--center the text-->
        <div class="col">
            <h1 class="text-center" id="page_title">Step 1: Read the Article</h1>
            <br><br>
        </div>
    </div>
    <div id="article" class="row">
        <!--make the background here light grey-->
        <div class="col-8" style="background-color: #f8f9fa;">
            <h2>{{title}}</h2>
            <!-- article contents here-->
            {% for paragraph in paragraphs %}
                <p id="{{paragraph.tag}}"">{{paragraph.text | safe}}</p>
            {% endfor %}
        </div>
        <!--make the background dark grey and all the text off-white-->
        <div class="col-4" style="background-color: #343a40; color: #f8f9fa;">
            <!-- word list here-->
            <h3>Vocabulary</h3>
            <br>
            <span id="wordlist"></span>
        </div>
    </div>
    <div id="review_vocab" class="row" hidden>
        <div class="col-3"></div>
        <div class="col-6" style="background-color: #f8f9fa;" id="vocabulary_list">
            
        </div>
        <div class="col-3"></div>
    </div>
    <div id="test_vocab" class="row" hidden>
        <div class="col-3"></div>
        <div class="col-6" style="background-color: #f8f9fa;" id="test_list">
            
        </div>
        <div class="col-3"></div>
    </div>
    <div class="row">
        <!--center the text-->
        <div class="col">
            <div class="d-grid gap-2">
                <br><br>
                <button class="btn btn-primary" type="button" id="submit_button" onclick="submit_vocabulary()">Review Vocabulary</button>
                <br><br>
            </div>
        </div>
    </div>
</div>

<script>

    //Create a global variable to store the vocabulary words and sentences
    var vocabulary = [];
    var translated_vocabulary = [];

    function vocabulary_list() {
        //Hide the article and show the vocabulary list
        document.getElementById("article").hidden = true;
        document.getElementById("review_vocab").hidden = false;
        //Change the title of the page
        document.getElementById("page_title").innerHTML = "Step 2: Review Vocabulary";
        //Update button
        document.getElementById("submit_button").innerHTML = "Complete Review!";
        document.getElementById("submit_button").setAttribute("onclick", "test_vocabulary()");
        var my_list = translated_vocabulary;
        //For each item in the list, create a span object
        for (var i = 0; i < my_list.length; i++) {
            var word = document.createElement("span");
            //The elements to add are word, base, translation, and example
            word.innerHTML = "<p><h5>Word: " + my_list[i].word + "</h5></p>"
            word.innerHTML += "<p>Base Form: " + my_list[i].base + "</p>"
            word.innerHTML += "<p>Translation: " + my_list[i].translation + "</p>"
            word.innerHTML += "<p>Example: " + my_list[i].example + "</p>"
            //Add example_translation
            word.innerHTML += "<p>Example Translation: " + my_list[i].example_translation + "</p>"
            //Now add a break
            word.innerHTML += "<br>"
            word.id = my_list[i].word;
            document.getElementById("vocabulary_list").appendChild(word);
        }
        //Bring the user to the top of the page
        window.scrollTo(0, 0);
    }


    //Create the submit_vocabulary function
    function submit_vocabulary() {
        //First make the button load
        document.getElementById("submit_button").innerHTML = "<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>Loading...";

        //Send the vocabulary list to the server with an AJAX request
        //The url is /submit_vocabulary
        //The data is the vocabulary list
        //The method is POST
        //The success function is the function below
        $.ajax({
            url: "/submit_vocabulary/",
            data: JSON.stringify(vocabulary),
            type: "POST",
            contentType: "application/json",
            //Set a header
            headers: {
                "X-Requested-With": "XMLHttpRequest",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            success: function(response) {
                //Log the response to the console
                console.log(response);
                translated_vocabulary = response;
                vocabulary_list();
            }
            //If there is an error, print the error to the console
        }).fail(function() {
            console.log("Error submitting vocabulary");
        });
    }

    function test_vocabulary() {
        document.getElementById("review_vocab").hidden = true;
        //Change the title of the page
        document.getElementById("page_title").innerHTML = "Step 3: Test Vocabulary";
        //Update button
        document.getElementById("submit_button").innerHTML = "Review Again!";
        document.getElementById("submit_button").setAttribute("onclick", "vocabulary_list()");
        //For each item in the list write the word and put a text box below it
        for (var i = 0; i < translated_vocabulary.length; i++) {
            var word = document.createElement("span");
            word.innerHTML = "<h5>" + translated_vocabulary[i].base + "</h5>";
            var input = document.createElement("input");
            input.type = "text";
            input.id = "testword_" + i.toString();
            input.placeholder = "Enter the translation here";
            document.getElementById("test_list").appendChild(word);
            document.getElementById("test_list").appendChild(input);
            //Add a listener to the input
            input.addEventListener("input", function() {
                //Get the value of the input
                var value = document.getElementById(this.id).value;
                //Get the index of the input
                var index = parseInt(this.id.split("_")[1]);
                //If the value is equal to the translation, change the color to green
                if (value == translated_vocabulary[index].translation) {
                    document.getElementById(this.id).style.color = "green";
                } else {
                    document.getElementById(this.id).style.color = "red";
                }
            });
        }
        document.getElementById("test_vocab").hidden = false;
        //Bring the user to the top of the page
        window.scrollTo(0, 0);
    }


    {% for item in w2s_map %}
        //Create an event listener for a span object with id "w1"
        document.getElementById("{{item.word}}").addEventListener("click", function() {
            //Get the value 
            var word_value = document.getElementById("{{item.word}}").innerText;
            //Add the word to the word list
            var wordlist = document.getElementById("wordlist");
            var word = document.createElement("span");
            word.innerHTML = word_value + "<br>";
            wordlist.appendChild(word);
            //Get the sentence value
            var sentence_value = document.getElementById("{{item.sentence}}").innerText;
            //Add the word and sentence to the vocabulary list
            vocabulary.push({word: word_value, sentence: sentence_value});
        });
    {% endfor %}

</script>
    

  </body>
</html>

